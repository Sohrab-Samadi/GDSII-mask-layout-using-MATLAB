% generate_layout_from_workspace.m
% ------------------------------------------------------------
% 1) Run params_all_circuits.m once to populate *_n variables
% 2) Run this file to generate all circuits and export GDS + PLS
% ------------------------------------------------------------

Ndevices = 9;

% Collect ALL elements from ALL circuits here
b = Raith_element.empty(1,0);
k = 0;  % global index into b


%in this block, the circuits 1-5 are generated.

for n = 1:5
    % Import *_n variables (e.g., waveguide_bb_3 -> waveguide_bb)
    import_params_for_n(n);

    % Build this circuit's elements into d(...)  (circuits 1-5 share this geometry)
    d = Raith_element.empty(1,0);



    %left side of the device

    %first gap
    d(end+1) = Raith_element('polygon',g_layer,[g1x_1 g1x_2 g1x_2 g1x_1 g1x_1; y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],dose_g1);

    %second gap
    d(end+1) =Raith_element('polygon',g_layer,[g2x_1 g2x_2 g2x_2 g2x_1 g2x_1; y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],dose_g2);

    %third gap
    d(end+1) =Raith_element('polygon',g_layer,[g3x_1 g3x_2 g3x_2 g3x_1 g3x_1; y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],dose_g3);

    %fourth gap
    d(end+1) =Raith_element('polygon',g_layer,[g4x_1 g4x_2 g4x_2 g4x_1 g4x_1; y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],dose_g4);

    %uniform gaps
    for i = 5:1:n_gap
        d(end+1) = Raith_element('polygon',g_layer,[g_uni_1+periodicity g_uni_2+periodicity g_uni_2+periodicity g_uni_1+periodicity g_uni_1+periodicity; y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],dose_g_uni);

        periodicity = constant_periodicity*(i-4);
    end

    %x coordinate of the last gap
    x_lastgap = constant_periodicity*(n_grating-4)+g_uni_2;

    %the etching around the coupler, taper, and waveguide that are all in one
    %writefield
    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l      g1x_1-rec-taper-waveguide_l       g1x_1-rec-taper-waveguide_l+waveguide_l       g1x_1-rec-taper-waveguide_l+waveguide_l+taper       g1x_1       x_lastgap+max_etch     x_lastgap+max_etch      g1x_1     g1x_1-rec      g1x_1-rec-taper      g1x_1-rec-taper-waveguide_l     g1x_1-rec-taper-waveguide_l      g1x_1-rec-taper-waveguide_l+waveguide_l            g1x_1-rec-taper-waveguide_l+waveguide_l                    g1x_1-rec-taper-waveguide_l+waveguide_l+taper      g1x_1     g1x_1+x_lastgap       g1x_1+x_lastgap      g1x_1       g1x_1-rec        g1x_1-rec-taper     g1x_1-rec-taper       g1x_1-rec-taper-waveguide_l;...
        (y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y     (y1_2/2)+(waveguide_w/2)+min_etch-delta_y         (y1_2/2)+(waveguide_w/2)+min_etch-delta_y       y1_2+max_etch-delta_y        y1_2+max_etch-delta_y       y1_2+max_etch-delta_y         y1_1-max_etch-delta_y        y1_1-max_etch-delta_y        y1_1-max_etch-delta_y       y1_1+(y1_2/2)-(waveguide_w/2)-min_etch-delta_y         y1_1+(y1_2/2)-(waveguide_w/2)-min_etch-delta_y        y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)-delta_y        y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)-delta_y            y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)+(w_fbms)-delta_y       y1_1-delta_y     y1_1-delta_y     y1_1-delta_y       y1_2-delta_y     y1_2-delta_y       y1_2-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms)-(w_fbms)-delta_y                (y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y                 (y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y], etchingdose_1);

%lower FBMS element, starting from the end of the taper to the middle of the
%device. For this one, I extracted the left positions in a vector and
%operated the mirror function on the coordinates of that vector.
%fbms_ln_coordinates means the fbms element, lower one, for the device
%number n left coordinates (the vector). We calculate the positions using the
%mirror function and plug them into one fbms element.

fbms_l1_coordinate = [g1x_1-rec-taper-waveguide_l+waveguide_l          g1x_1-rec-taper-waveguide_l         g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+(waveguide_w)+(w_fbms)            g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+(waveguide_w)+(w_fbms)            g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)              g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide            g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)          g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)            g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)             g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)      g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)                      g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)                  g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)                    g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)                        g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)                        g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)                   g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)                   g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)+(bend)-(waveguide_w/2)-(w_fbms/2);...
    (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)-delta_y               (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)-delta_y            (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-delta_y                  (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-delta_y     (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-delta_y                (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-delta_y                   (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)-delta_y                       (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)-delta_y       (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)-delta_y                        (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)-delta_y                     (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-delta_y      (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-delta_y                         (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-delta_y                         (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-(d1_length_1)-delta_y                          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-(d1_length_1)-(bend)+(w_fbms/2)+(waveguide_w/2)-delta_y];



%fbms_ln_coordinate_m means the mth point in the mirrord fbms_ln_coordinate device, so it is in the right side.
fbms_l1_coordinate_21 = mirror_coords(fbms_l1_coordinate(1,1),fbms_l1_coordinate(2,1),mirror_x);
%the x and y coordinates of the points.
x_fbms_l1_coordinate_21 = fbms_l1_coordinate_21(1);
y_fbms_l1_coordinate_21 = fbms_l1_coordinate_21(2);


fbms_l1_coordinate_20 = mirror_coords(fbms_l1_coordinate(1,2),fbms_l1_coordinate(2,2),mirror_x);
x_fbms_l1_coordinate_20 = fbms_l1_coordinate_20(1);
y_fbms_l1_coordinate_20 = fbms_l1_coordinate_20(2);


fbms_l1_coordinate_19 = mirror_coords(fbms_l1_coordinate(1,3),fbms_l1_coordinate(2,3),mirror_x);
x_fbms_l1_coordinate_19 = fbms_l1_coordinate_19(1);
y_fbms_l1_coordinate_19 = fbms_l1_coordinate_19(2);


fbms_l1_coordinate_18 = mirror_coords(fbms_l1_coordinate(1,4),fbms_l1_coordinate(2,4),mirror_x);
x_fbms_l1_coordinate_18 = fbms_l1_coordinate_18(1);
y_fbms_l1_coordinate_18 = fbms_l1_coordinate_18(2);

fbms_l1_coordinate_17 = mirror_coords(fbms_l1_coordinate(1,5),fbms_l1_coordinate(2,5),mirror_x);
x_fbms_l1_coordinate_17 = fbms_l1_coordinate_17(1);
y_fbms_l1_coordinate_17 = fbms_l1_coordinate_17(2);

fbms_l1_coordinate_16 = mirror_coords(fbms_l1_coordinate(1,6),fbms_l1_coordinate(2,6),mirror_x);

x_fbms_l1_coordinate_16 = fbms_l1_coordinate_16(1);
y_fbms_l1_coordinate_16 = fbms_l1_coordinate_16(2);

fbms_l1_coordinate_15 = mirror_coords(fbms_l1_coordinate(1,7),fbms_l1_coordinate(2,7),mirror_x);
x_fbms_l1_coordinate_15 = fbms_l1_coordinate_15(1);
y_fbms_l1_coordinate_15 = fbms_l1_coordinate_15(2);

fbms_l1_coordinate_14 = mirror_coords(fbms_l1_coordinate(1,8),fbms_l1_coordinate(2,8),mirror_x);
x_fbms_l1_coordinate_14 = fbms_l1_coordinate_14(1);
y_fbms_l1_coordinate_14 = fbms_l1_coordinate_14(2);

fbms_l1_coordinate_13 = mirror_coords(fbms_l1_coordinate(1,9),fbms_l1_coordinate(2,9),mirror_x);
x_fbms_l1_coordinate_13 = fbms_l1_coordinate_13(1);
y_fbms_l1_coordinate_13 = fbms_l1_coordinate_13(2)

fbms_l1_coordinate_12 = mirror_coords(fbms_l1_coordinate(1,10),fbms_l1_coordinate(2,10),mirror_x);
x_fbms_l1_coordinate_12 = fbms_l1_coordinate_12(1);
y_fbms_l1_coordinate_12 = fbms_l1_coordinate_12(2);

fbms_l1_coordinate_11 = mirror_coords(fbms_l1_coordinate(1,11),fbms_l1_coordinate(2,11),mirror_x);
x_fbms_l1_coordinate_11 = fbms_l1_coordinate_11(1);
y_fbms_l1_coordinate_11 = fbms_l1_coordinate_11(2)

fbms_l1_coordinate_10 = mirror_coords(fbms_l1_coordinate(1,12),fbms_l1_coordinate(2,12),mirror_x);
x_fbms_l1_coordinate_10 = fbms_l1_coordinate_10(1);
y_fbms_l1_coordinate_10 = fbms_l1_coordinate_10(2);

fbms_l1_coordinate_9 = mirror_coords(fbms_l1_coordinate(1,13),fbms_l1_coordinate(2,13),mirror_x);
x_fbms_l1_coordinate_9 = fbms_l1_coordinate_9(1);
y_fbms_l1_coordinate_9 = fbms_l1_coordinate_9(2)

fbms_l1_coordinate_8 = mirror_coords(fbms_l1_coordinate(1,14),fbms_l1_coordinate(2,14),mirror_x);
x_fbms_l1_coordinate_8 = fbms_l1_coordinate_8(1);
y_fbms_l1_coordinate_8 = fbms_l1_coordinate_8(2);

fbms_l1_coordinate_7 = mirror_coords(fbms_l1_coordinate(1,15),fbms_l1_coordinate(2,15),mirror_x);
x_fbms_l1_coordinate_7 = fbms_l1_coordinate_7(1);
y_fbms_l1_coordinate_7 = fbms_l1_coordinate_7(2);

fbms_l1_coordinate_6 = mirror_coords(fbms_l1_coordinate(1,16),fbms_l1_coordinate(2,16),mirror_x);
x_fbms_l1_coordinate_6 = fbms_l1_coordinate_6(1);
y_fbms_l1_coordinate_6 = fbms_l1_coordinate_6(2)

fbms_l1_coordinate_5 = mirror_coords(fbms_l1_coordinate(1,17),fbms_l1_coordinate(2,17),mirror_x);
x_fbms_l1_coordinate_5 = fbms_l1_coordinate_5(1);
y_fbms_l1_coordinate_5 = fbms_l1_coordinate_5(2);

fbms_l1_coordinate_4 = mirror_coords(fbms_l1_coordinate(1,18),fbms_l1_coordinate(2,18),mirror_x);
x_fbms_l1_coordinate_4 = fbms_l1_coordinate_4(1);
y_fbms_l1_coordinate_4 = fbms_l1_coordinate_4(2)

fbms_l1_coordinate_3 = mirror_coords(fbms_l1_coordinate(1,19),fbms_l1_coordinate(2,19),mirror_x);
x_fbms_l1_coordinate_3 = fbms_l1_coordinate_3(1);
y_fbms_l1_coordinate_3 = fbms_l1_coordinate_3(2);

fbms_l1_coordinate_2 = mirror_coords(fbms_l1_coordinate(1,20),fbms_l1_coordinate(2,20),mirror_x);
x_fbms_l1_coordinate_2 = fbms_l1_coordinate_2(1);
y_fbms_l1_coordinate_2 = fbms_l1_coordinate_2(2)

fbms_l1_coordinate_1 = mirror_coords(fbms_l1_coordinate(1,21),fbms_l1_coordinate(2,21),mirror_x);
x_fbms_l1_coordinate_1 = fbms_l1_coordinate_1(1);
y_fbms_l1_coordinate_1 = fbms_l1_coordinate_1(2);




d(end+1) =Raith_element('fbmspath',fbms_layer,[g1x_1-rec-taper-waveguide_l+waveguide_l          g1x_1-rec-taper-waveguide_l         g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+(waveguide_w)+(w_fbms)            g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+(waveguide_w)+(w_fbms)            g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)              g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide            g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)          g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)            g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)             g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)      g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)                      g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)                  g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)                    g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)                        g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)                        g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)                   g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)                   g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)+(bend)-(waveguide_w/2)-(w_fbms/2)     x_fbms_l1_coordinate_1      x_fbms_l1_coordinate_2     x_fbms_l1_coordinate_3     x_fbms_l1_coordinate_4     x_fbms_l1_coordinate_5      x_fbms_l1_coordinate_6      x_fbms_l1_coordinate_7     x_fbms_l1_coordinate_8      x_fbms_l1_coordinate_9    x_fbms_l1_coordinate_10  x_fbms_l1_coordinate_11  x_fbms_l1_coordinate_12    x_fbms_l1_coordinate_13    x_fbms_l1_coordinate_14   x_fbms_l1_coordinate_15    x_fbms_l1_coordinate_16    x_fbms_l1_coordinate_17    x_fbms_l1_coordinate_18    x_fbms_l1_coordinate_19    x_fbms_l1_coordinate_20    x_fbms_l1_coordinate_21  ;...
    (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)-delta_y               (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)-delta_y            (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-delta_y                  (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-delta_y     (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-delta_y                (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-delta_y                   (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)-delta_y                       (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)-delta_y       (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)-delta_y                        (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)-delta_y                     (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-delta_y      (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-delta_y                         (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-delta_y                         (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-(d1_length_1)-delta_y                          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-(d1_length_1)-(bend)+(w_fbms/2)+(waveguide_w/2)-delta_y    y_fbms_l1_coordinate_1   y_fbms_l1_coordinate_2   y_fbms_l1_coordinate_3    y_fbms_l1_coordinate_4     y_fbms_l1_coordinate_5    y_fbms_l1_coordinate_6    y_fbms_l1_coordinate_7   y_fbms_l1_coordinate_8    y_fbms_l1_coordinate_9    y_fbms_l1_coordinate_10    y_fbms_l1_coordinate_11    y_fbms_l1_coordinate_12    y_fbms_l1_coordinate_13    y_fbms_l1_coordinate_14    y_fbms_l1_coordinate_15   y_fbms_l1_coordinate_16     y_fbms_l1_coordinate_17     y_fbms_l1_coordinate_18     y_fbms_l1_coordinate_19   y_fbms_l1_coordinate_20    y_fbms_l1_coordinate_21 ]...
    ,[0       0        -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)        0        -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)         0          -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)           0          (bend+(w_fbms/2)+(waveguide_w/2))*(sqrt(2)-1)/sqrt(2)          0          (bend+(w_fbms/2)+(waveguide_w/2))*(sqrt(2)-1)/sqrt(2)        0         -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)          0         -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)         0          (bend+(w_fbms/2)+(waveguide_w/2))*(sqrt(2)-1)/sqrt(2)           0                           (bend+(w_fbms/2)+(waveguide_w/2))*(sqrt(2)-1)/sqrt(2)           0           -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)    0    -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)     0     (bend+(w_fbms/2)+(waveguide_w/2))*(sqrt(2)-1)/sqrt(2)     0      (bend+(w_fbms/2)+(waveguide_w/2))*(sqrt(2)-1)/sqrt(2)     0     -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)    0    -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)   0  (bend+(w_fbms/2)+(waveguide_w/2))*(sqrt(2)-1)/sqrt(2)    0    (bend+(w_fbms/2)+(waveguide_w/2))*(sqrt(2)-1)/sqrt(2)    0   -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)   0    -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)  0   -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)   0 ], w_fbms, dose_fbms);


%Upper FBMS element. The mirror function terms are simplified
%into one for loop.
fbms_U1_coordinate = [g1x_1-rec-taper-waveguide_l+waveguide_l          g1x_1-rec-taper-waveguide_l         g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+(waveguide_w)+(w_fbms)-(waveguide_w)-(w_fbms)             g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+(waveguide_w)+(w_fbms)-(waveguide_w)-(w_fbms)             g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)              g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide            g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+(waveguide_w)+(w_fbms)           g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+(waveguide_w)+(w_fbms)             g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)             g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)               g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)                       g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)                   g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)                    g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)-(w_fbms/2)-(waveguide_w/2)+bend                      g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)                        g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)-(waveguide_w)-(w_fbms)                    g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)-(waveguide_w)-(w_fbms)                    g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)+(bend)-(waveguide_w/2)-(w_fbms/2);...
    (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+(waveguide_w)+(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+(waveguide_w)+(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)-(waveguide_w)-(w_fbms)-delta_y                (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)-(waveguide_w)-(w_fbms)-delta_y             (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y                   (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y      (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-delta_y                (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-delta_y                   (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y                        (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)-delta_y                        (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)-delta_y                     (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(waveguide_w)-(w_fbms)-delta_y       (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(waveguide_w)-(w_fbms)-delta_y                          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-delta_y                         (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-(d1_length_1)-delta_y                          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-(d1_length_1)-(bend)+(w_fbms/2)+(waveguide_w/2)-(waveguide_w)-(w_fbms)-delta_y ];


for i = 1:21
    fbms_U1_coordinate_i = mirror_coords(fbms_U1_coordinate(1, i), fbms_U1_coordinate(2, i), mirror_x);
    assignin('base', sprintf('x_fbms_U1_coordinate_%d', 22 - i), fbms_U1_coordinate_i(1));
    assignin('base', sprintf('y_fbms_U1_coordinate_%d', 22 - i), fbms_U1_coordinate_i(2));
end






d(end+1) =Raith_element('fbmspath',fbms_layer,[g1x_1-rec-taper-waveguide_l+waveguide_l          g1x_1-rec-taper-waveguide_l         g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+(waveguide_w)+(w_fbms)-(waveguide_w)-(w_fbms)             g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+(waveguide_w)+(w_fbms)-(waveguide_w)-(w_fbms)             g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)              g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide            g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+(waveguide_w)+(w_fbms)           g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+(waveguide_w)+(w_fbms)             g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)             g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)               g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)                       g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)                   g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)                    g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)                     g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)-(w_fbms/2)-(waveguide_w/2)+bend                      g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)                        g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)-(waveguide_w)-(w_fbms)                    g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)-(waveguide_w)-(w_fbms)                    g1x_1-rec-taper-waveguide_l-(w_fbms/2)-bend-(waveguide_w/2)+bend+(waveguide_w/2)+(w_fbms/2)+p_waveguide+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+bend+(waveguide_w/2)+(w_fbms/2)+(waveguide_bb)+(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(waveguide_w/2)-(w_fbms/2)+(waveguide_bb_1)+(bend)-(waveguide_w/2)-(w_fbms/2)+(bend)+(w_fbms/2)+(waveguide_w/2)+(waveguide_bb)+(bend)+(w_fbms/2)+(waveguide_w/2)+(bend)-(waveguide_w/2)-(w_fbms/2)     x_fbms_U1_coordinate_1      x_fbms_U1_coordinate_2     x_fbms_U1_coordinate_3     x_fbms_U1_coordinate_4     x_fbms_U1_coordinate_5      x_fbms_U1_coordinate_6      x_fbms_U1_coordinate_7    x_fbms_U1_coordinate_8      x_fbms_U1_coordinate_9    x_fbms_U1_coordinate_10  x_fbms_U1_coordinate_11  x_fbms_U1_coordinate_12    x_fbms_U1_coordinate_13    x_fbms_U1_coordinate_14   x_fbms_U1_coordinate_15    x_fbms_U1_coordinate_16    x_fbms_U1_coordinate_17    x_fbms_U1_coordinate_18    x_fbms_U1_coordinate_19    x_fbms_U1_coordinate_20    x_fbms_U1_coordinate_21  ;...
    (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+(waveguide_w)+(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)+(waveguide_w)+(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)-(waveguide_w)-(w_fbms)-delta_y                (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+(waveguide_w)+(w_fbms)-(waveguide_w)-(w_fbms)-delta_y             (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y                   (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y      (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-delta_y                (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-delta_y                   (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y                        (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)-(waveguide_w)-(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)-delta_y                        (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)-delta_y                     (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(waveguide_w)-(w_fbms)-delta_y       (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(waveguide_w)-(w_fbms)-delta_y                          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-delta_y                         (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-(d1_length_1)-delta_y                          (y1_2/2)+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms/2)+bend+(waveguide_w/2)+(w_fbms/2)+d1_length_1+bend+(waveguide_w/2)+(w_fbms/2)-(w_fbms/2)-(waveguide_w/2)-(bend)-(d1_length_1)-(bend)+(waveguide_w/2)+(w_fbms/2)+(bend)-(w_fbms/2)-(waveguide_w/2)+(d1_length_1)+(bend)+(w_fbms/2)+(waveguide_w/2)-(bend)-(w_fbms/2)-(waveguide_w/2)-(d1_length_1)-(bend)+(w_fbms/2)+(waveguide_w/2)-(waveguide_w)-(w_fbms)-delta_y         y_fbms_U1_coordinate_1   y_fbms_U1_coordinate_2   y_fbms_U1_coordinate_3    y_fbms_U1_coordinate_4     y_fbms_U1_coordinate_5    y_fbms_U1_coordinate_6    y_fbms_U1_coordinate_7   y_fbms_U1_coordinate_8    y_fbms_U1_coordinate_9    y_fbms_U1_coordinate_10    y_fbms_U1_coordinate_11    y_fbms_U1_coordinate_12    y_fbms_U1_coordinate_13    y_fbms_U1_coordinate_14    y_fbms_U1_coordinate_15   y_fbms_U1_coordinate_16     y_fbms_U1_coordinate_17     y_fbms_U1_coordinate_18     y_fbms_U1_coordinate_19   y_fbms_U1_coordinate_20    y_fbms_U1_coordinate_21 ]...
    ,[0       0        -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)        0        -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)         0          -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)           0          (bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)          0          (bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)        0         -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)          0         -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)         0          (bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)           0                           (bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)           0           -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)    0    -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)     0     (bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)     0      (bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)     0     -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)    0    -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)   0  (bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)    0    (bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w))*(sqrt(2)-1)/sqrt(2)    0   -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)   0    -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)  0   -(bend+(w_fbms/2)+(waveguide_w/2)-(w_fbms)-(waveguide_w)+(w_fbms)+(waveguide_w))*(sqrt(2)-1)/sqrt(2)   0 ], w_fbms, dose_fbms);





%defining of the etching elemets around the upper fbms elemet
d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l  (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],90,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)         g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)         g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)       g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)    ; ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y  ],   etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l        g1x_1-rec-taper-waveguide_l+p_waveguide         g1x_1-rec-taper-waveguide_l+p_waveguide g1x_1-rec-taper-waveguide_l+p_waveguide-p_waveguide     g1x_1-rec-taper-waveguide_l;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y          (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y  ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],270,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms);...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y ],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],90,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms);...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-delta_y             (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y  ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],0,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)++waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w       g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w       g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1       g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1-delta_y            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y  ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb+waveguide_bb_1         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],270,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+4*bend+waveguide_bb++waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+waveguide_bb_1+4*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y ],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],90,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+4*bend+waveguide_bb+waveguide_bb_1         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb_1)+4*bend+2*waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb_1)+4*bend+2*waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+4*bend+waveguide_bb+waveguide_bb_1;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-delta_y             (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y  ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+waveguide_bb+4*bend+waveguide_bb_1        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y ],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],0,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)++waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w+4*bend+waveguide_bb_1+waveguide_bb       g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+waveguide_bb_1+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w+4*bend+2*waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+waveguide_bb_1+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w+4*bend+2*waveguide_bb       g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb_1+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w+4*bend+2*waveguide_bb;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb_1+waveguide_bb+4*bend+waveguide_bb         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1+0.5*waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1+0.5*waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1 ;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1-delta_y            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y  ],etchingdose_2);

%Now for the right section etching elements, we plug the
%above elements into the mirror function and define them.

[d1r_bend1_uv_c, d1r_bend1_angle, d1r_bend1_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l  (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y], 90, [0 90], mirror_x);
d(end+1) =Raith_element('arc',0,d1r_bend1_uv_c,bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),d1r_bend1_theta,d1r_bend1_angle,etch_w,N,etchingdose_2);


d(end+1) =Raith_element('polygon',0,mirror_coords([g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)         g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)         g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)       g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y],mirror_x),   etchingdose_2);

[d1r_bend2_uv_c, d1r_bend2_angle, d1r_bend2_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l   (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], 180, [0 90], mirror_x);
d(end+1) =Raith_element('arc',0,d1r_bend2_uv_c,bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),d1r_bend2_theta,d1r_bend2_angle,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,mirror_coords([g1x_1-rec-taper-waveguide_l        g1x_1-rec-taper-waveguide_l+p_waveguide         g1x_1-rec-taper-waveguide_l+p_waveguide g1x_1-rec-taper-waveguide_l+p_waveguide-p_waveguide     g1x_1-rec-taper-waveguide_l],...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y          (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y],mirror_x),etchingdose_2);

[d1r_bend3_uv_c, d1r_bend3_angle, d1r_bend3_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide   (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], 270, [0 90], mirror_x);
d(end+1) =Raith_element('arc',0,d1r_bend3_uv_c,bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),d1r_bend3_theta,d1r_bend3_angle,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)],...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y],mirror_x),etchingdose_2);

[d1r_bend4_uv_c, d1r_bend4_angle, d1r_bend4_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)   (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y], 90, [0 90], mirror_x);
d(end+1) =Raith_element('arc',0,d1r_bend4_uv_c,bend-(waveguide_w/2)-w_fbms-(etch_w/2),d1r_bend4_theta,d1r_bend4_angle,etch_w,N,etchingdose_2);

d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y+(etch_w), ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y], mirror_x), etchingdose_2);



[d1r_bend5_uv_c, d1r_bend5_angle, d1r_bend5_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)      (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y], 0, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend5_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d1r_bend5_theta, d1r_bend5_angle, etch_w, N, etchingdose_2);

d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w, ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w, ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w, ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w, ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], mirror_x), etchingdose_2);

[d1r_bend6_uv_c, d1r_bend6_angle, d1r_bend6_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb     (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], 180, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend6_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d1r_bend6_theta, d1r_bend6_angle, etch_w, N, etchingdose_2);

d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1       g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y], mirror_x), etchingdose_2);

[d1r_bend7_uv_c, d1r_bend7_angle, d1r_bend7_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb+waveguide_bb_1     (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], 270, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend7_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d1r_bend7_theta, d1r_bend7_angle, etch_w, N, etchingdose_2);

d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+4*bend+waveguide_bb++waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], mirror_x), etchingdose_2);



[d1r_bend5_uv_c, d1r_bend5_angle, d1r_bend5_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+waveguide_bb_1+4*bend, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y], 90, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend5_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d1r_bend5_theta, d1r_bend5_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+4*bend+waveguide_bb+waveguide_bb_1         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb_1)+4*bend+2*waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb_1)+4*bend+2*waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+4*bend+waveguide_bb+waveguide_bb_1], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y], mirror_x), etchingdose_2);



[d1r_bend6_uv_c, d1r_bend6_angle, d1r_bend6_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+waveguide_bb+4*bend+waveguide_bb_1 , ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y], 0, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend6_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d1r_bend6_theta, d1r_bend6_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)++waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w+4*bend+waveguide_bb_1+waveguide_bb       g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+waveguide_bb_1+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w+4*bend+2*waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+waveguide_bb_1+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w+4*bend+2*waveguide_bb       g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb_1+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w+4*bend+2*waveguide_bb], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], mirror_x), etchingdose_2);


[d1r_bend7_uv_c, d1r_bend7_angle, d1r_bend7_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb_1+waveguide_bb+4*bend+waveguide_bb, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], 180, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend7_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d1r_bend7_theta, d1r_bend7_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1+0.5*waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1+0.5*waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1 ], ...
    [ (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1-delta_y...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y], mirror_x), etchingdose_2);





%%defining of the etching elemets around the lower fbms elemet
d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l  (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],90,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)         g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)          g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)         g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)     ; ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y  ],   etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l        g1x_1-rec-taper-waveguide_l+p_waveguide         g1x_1-rec-taper-waveguide_l+p_waveguide g1x_1-rec-taper-waveguide_l+p_waveguide-p_waveguide     g1x_1-rec-taper-waveguide_l;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y  ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],270,etch_w,N,etchingdose_2);


d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms) );...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y ],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],90,etch_w,N,etchingdose_2);


d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms);...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y              (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y   ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y ],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],0,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+2*bend+waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+2*bend+waveguide_bb ;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y ],etchingdose_2);


d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y             (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y   ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb+waveguide_bb_1         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],270,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1          g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1 );...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y ],etchingdose_2);

d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+4*bend+waveguide_bb_1       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y ],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],90,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend          g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb_1)+2*waveguide_bb+4*bend         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb_1)+2*waveguide_bb+4*bend         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend ;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y              (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y   ],etchingdose_2);


d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb_1+4*bend+waveguide_bb+waveguide_bb       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y ],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],0,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+2*waveguide_bb+2*bend+waveguide_bb_1+2*w_fbms+waveguide_w+etch_w        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+2*waveguide_bb+2*bend+waveguide_bb_1+2*w_fbms+waveguide_w+etch_w          g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+2*waveguide_bb+2*bend+waveguide_bb_1+2*w_fbms+waveguide_w+etch_w          g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+2*waveguide_bb+2*bend+waveguide_bb_1+2*w_fbms+waveguide_w+etch_w          g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+2*waveguide_bb+2*bend+waveguide_bb_1+2*w_fbms+waveguide_w+etch_w  );...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y ],etchingdose_2);


d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb+waveguide_bb_1+4*bend+waveguide_bb         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);

d(end+1) =Raith_element('polygon',0,[...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1+0.5*waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1+0.5*waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1 ;...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y             (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y   ],etchingdose_2);


%Now for the right section etching elements, we plug the
%above elements into the mirror function and define them.



[d1r_bend8_uv_c, d1r_bend8_angle, d1r_bend8_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y], 90, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend8_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d1r_bend8_theta, d1r_bend8_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms), ...
    g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms), ...
    g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms), ...
    g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms), ...
    g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y], mirror_x), etchingdose_2);


[d1r_bend9_uv_c, d1r_bend9_angle, d1r_bend9_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], 180, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend9_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d1r_bend9_theta, d1r_bend9_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l, ...
    g1x_1-rec-taper-waveguide_l+p_waveguide, ...
    g1x_1-rec-taper-waveguide_l+p_waveguide, ...
    g1x_1-rec-taper-waveguide_l+p_waveguide-p_waveguide, ...
    g1x_1-rec-taper-waveguide_l], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y], mirror_x), etchingdose_2);


[d1r_bend10_uv_c, d1r_bend10_angle, d1r_bend10_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], 270, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend10_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d1r_bend10_theta, d1r_bend10_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms))], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], mirror_x), etchingdose_2);


[d1r_bend11_uv_c, d1r_bend11_angle, d1r_bend11_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms), ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y], 90, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend11_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d1r_bend11_theta, d1r_bend11_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb), ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y], mirror_x), etchingdose_2);




[d1r_bend12_uv_c, d1r_bend12_angle, d1r_bend12_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y], 0, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend12_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d1r_bend12_theta, d1r_bend12_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+2*bend+waveguide_bb, ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+2*bend+waveguide_bb, ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+2*bend+waveguide_bb, ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+2*bend+waveguide_bb, ...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+2*bend+waveguide_bb], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], mirror_x), etchingdose_2);


[d1r_bend13_uv_c, d1r_bend13_angle, d1r_bend13_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], 180, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend13_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d1r_bend13_theta, d1r_bend13_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y], mirror_x), etchingdose_2);



[d1r_bend14_uv_c, d1r_bend14_angle, d1r_bend14_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb+waveguide_bb_1 , ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], 270, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend14_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d1r_bend14_theta, d1r_bend14_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1          g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1)], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], mirror_x), etchingdose_2);


[d1r_bend15_uv_c, d1r_bend15_angle, d1r_bend15_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+4*bend+waveguide_bb_1 , ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y], 90, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend15_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d1r_bend15_theta, d1r_bend15_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend          g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb_1)+2*waveguide_bb+4*bend         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb_1)+2*waveguide_bb+4*bend         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend ], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y], mirror_x), etchingdose_2);



[d1r_bend16_uv_c, d1r_bend16_angle, d1r_bend16_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb_1+4*bend+waveguide_bb+waveguide_bb, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y], 0, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend16_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d1r_bend16_theta, d1r_bend16_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+2*waveguide_bb+2*bend+waveguide_bb_1+2*w_fbms+waveguide_w+etch_w        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+2*waveguide_bb+2*bend+waveguide_bb_1+2*w_fbms+waveguide_w+etch_w          g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+2*waveguide_bb+2*bend+waveguide_bb_1+2*w_fbms+waveguide_w+etch_w          g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+2*waveguide_bb+2*bend+waveguide_bb_1+2*w_fbms+waveguide_w+etch_w          g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+2*waveguide_bb+2*bend+waveguide_bb_1+2*w_fbms+waveguide_w+etch_w], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], mirror_x), etchingdose_2);


[d1r_bend17_uv_c, d1r_bend17_angle, d1r_bend17_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb+waveguide_bb_1+4*bend+waveguide_bb , ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y], 180, [0 90], mirror_x);
d(end+1) = Raith_element('arc', 0, d1r_bend17_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d1r_bend17_theta, d1r_bend17_angle, etch_w, N, etchingdose_2);


d(end+1) = Raith_element('polygon', 0, mirror_coords([...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1+0.5*waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1+0.5*waveguide_bb_1...
    g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb+4*bend+waveguide_bb+waveguide_bb_1], ...
    [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y, ...
    (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y], mirror_x), etchingdose_2);



%%finaly, we mirror the grating section and the etches around it to the right
%%side.
%First gap
d(end+1) =Raith_element('polygon',g_layer,mirror_coords([g1x_1 g1x_2 g1x_2 g1x_1 g1x_1], [y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y], mirror_x),dose_g1);

%second gap
d(end+1) =Raith_element('polygon',g_layer,mirror_coords([g2x_1 g2x_2 g2x_2 g2x_1 g2x_1], [y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],mirror_x),dose_g2);
axis equal

%third gap
d(end+1) =Raith_element('polygon',g_layer,mirror_coords([g3x_1 g3x_2 g3x_2 g3x_1 g3x_1], [y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],mirror_x),dose_g3);
axis equal

%fourth gap
d(end+1) =Raith_element('polygon',g_layer,mirror_coords([g4x_1 g4x_2 g4x_2 g4x_1 g4x_1], [y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],mirror_x),dose_g4);
axis equal



%uniform gaps
for i = 129:1:124+n_gap
    d(end+1) = Raith_element('polygon',g_layer,mirror_coords([g_uni_1+periodicity_1 g_uni_2+periodicity_1 g_uni_2+periodicity_1 g_uni_1+periodicity_1 g_uni_1+periodicity_1], [y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],mirror_x),dose_g_uni);
    axis equal

    periodicity_1 = constant_periodicity_1*(i-128);
end

%the etching around the coupler, taper, and waveguide that are all in one
%writefield
d(end+1) =Raith_element('polygon',0,mirror_coords([g1x_1-rec-taper-waveguide_l      g1x_1-rec-taper-waveguide_l       g1x_1-rec-taper-waveguide_l+waveguide_l       g1x_1-rec-taper-waveguide_l+waveguide_l+taper       g1x_1       x_lastgap+max_etch     x_lastgap+max_etch      g1x_1     g1x_1-rec      g1x_1-rec-taper      g1x_1-rec-taper-waveguide_l     g1x_1-rec-taper-waveguide_l      g1x_1-rec-taper-waveguide_l+waveguide_l            g1x_1-rec-taper-waveguide_l+waveguide_l                    g1x_1-rec-taper-waveguide_l+waveguide_l+taper      g1x_1     g1x_1+x_lastgap       g1x_1+x_lastgap      g1x_1       g1x_1-rec        g1x_1-rec-taper     g1x_1-rec-taper       g1x_1-rec-taper-waveguide_l],...
    [(y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y     (y1_2/2)+(waveguide_w/2)+min_etch-delta_y         (y1_2/2)+(waveguide_w/2)+min_etch-delta_y       y1_2+max_etch-delta_y        y1_2+max_etch-delta_y       y1_2+max_etch-delta_y         y1_1-max_etch-delta_y        y1_1-max_etch-delta_y        y1_1-max_etch-delta_y       y1_1+(y1_2/2)-(waveguide_w/2)-min_etch-delta_y         y1_1+(y1_2/2)-(waveguide_w/2)-min_etch-delta_y        y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)-delta_y        y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)-delta_y            y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)+(w_fbms)-delta_y       y1_1-delta_y     y1_1-delta_y     y1_1-delta_y       y1_2-delta_y      y1_2-delta_y       y1_2-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms)-(w_fbms)-delta_y                (y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y                 (y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y],mirror_x), etchingdose_1);


    % Append this circuit's elements into global b
    % (Assumes d is a row/column array of Raith_element)
    if isempty(d)
        error('Circuit %d produced an empty d array. Check geometry block.', n);
    end
    Nd = numel(d);
    b(k+1:k+Nd) = d(:).';
    k = k + Nd;
end



 % in this block, circuits 6-9 are generated.
for n = 6:9
    % Import *_n variables (e.g., waveguide_bb_6 -> waveguide_bb)
    import_params_for_n(n);

    % Build this circuit's elements into d(...)  (circuits 6-9 share circuit-6 geometry)
    d = Raith_element.empty(1,0);


    %left side of the device

    %first gap
    d(end+1) = Raith_element('polygon',g_layer,[g1x_1 g1x_2 g1x_2 g1x_1 g1x_1; y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],dose_g1);

    %second gap
    d(end+1) =Raith_element('polygon',g_layer,[g2x_1 g2x_2 g2x_2 g2x_1 g2x_1; y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],dose_g2);

    %third gap
    d(end+1) =Raith_element('polygon',g_layer,[g3x_1 g3x_2 g3x_2 g3x_1 g3x_1; y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],dose_g3);

    %fourth gap
    d(end+1) =Raith_element('polygon',g_layer,[g4x_1 g4x_2 g4x_2 g4x_1 g4x_1; y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],dose_g4);



    %uniform gaps
    for i = 5:1:n_gap
        d(end+1) = Raith_element('polygon',g_layer,[g_uni_1+periodicity g_uni_2+periodicity g_uni_2+periodicity g_uni_1+periodicity g_uni_1+periodicity; y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],dose_g_uni);

        periodicity = constant_periodicity*(i-4);
    end

    %x coordinate of the last gap
    x_lastgap = constant_periodicity*(n_grating-4)+g_uni_2;

    %the etching around the coupler, taper, and waveguide that are all in one
    %writefield
    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l      g1x_1-rec-taper-waveguide_l       g1x_1-rec-taper-waveguide_l+waveguide_l       g1x_1-rec-taper-waveguide_l+waveguide_l+taper       g1x_1       x_lastgap+max_etch     x_lastgap+max_etch      g1x_1     g1x_1-rec      g1x_1-rec-taper      g1x_1-rec-taper-waveguide_l     g1x_1-rec-taper-waveguide_l      g1x_1-rec-taper-waveguide_l+waveguide_l            g1x_1-rec-taper-waveguide_l+waveguide_l                    g1x_1-rec-taper-waveguide_l+waveguide_l+taper      g1x_1     g1x_1+x_lastgap       g1x_1+x_lastgap      g1x_1       g1x_1-rec        g1x_1-rec-taper     g1x_1-rec-taper       g1x_1-rec-taper-waveguide_l;...
        (y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y     (y1_2/2)+(waveguide_w/2)+min_etch-delta_y         (y1_2/2)+(waveguide_w/2)+min_etch-delta_y       y1_2+max_etch-delta_y        y1_2+max_etch-delta_y       y1_2+max_etch-delta_y         y1_1-max_etch-delta_y        y1_1-max_etch-delta_y        y1_1-max_etch-delta_y       y1_1+(y1_2/2)-(waveguide_w/2)-min_etch-delta_y         y1_1+(y1_2/2)-(waveguide_w/2)-min_etch-delta_y        y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)-delta_y        y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)-delta_y            y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)+(w_fbms)-delta_y       y1_1-delta_y     y1_1-delta_y     y1_1-delta_y       y1_2-delta_y     y1_2-delta_y       y1_2-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms)-(w_fbms)-delta_y                (y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y                 (y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y], etchingdose_1);




    %defining of the etching elemets around the upper fbms elemet
    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)         g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)         g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)       g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)    ; ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend  ],   etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l  (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend-d1_length],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],90,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l        g1x_1-rec-taper-waveguide_l+p_waveguide         g1x_1-rec-taper-waveguide_l+p_waveguide g1x_1-rec-taper-waveguide_l+p_waveguide-p_waveguide     g1x_1-rec-taper-waveguide_l;...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y+4*bend...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y+4*bend...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y+4*bend...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y+4*bend...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y+4*bend   ],etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],0,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms);...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend ],etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend ],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms);...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-delta_y            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y  ],etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],270,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)++waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w       g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w       g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w;...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend ],etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],90,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1       g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb;...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y+4*bend       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y+4*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y+4*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1-delta_y+4*bend             (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y+4*bend   ],etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb+waveguide_bb_1         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],0,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+4*bend+waveguide_bb++waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1;...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend  ],etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+waveguide_bb_1+4*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend ],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend+0.5*waveguide_bb...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend+0.5*waveguide_bb...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend ;...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y-etch_w-2*w_fbms-waveguide_w        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y-etch_w-2*w_fbms-waveguide_w         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y-etch_w-2*w_fbms-waveguide_w         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y-etch_w-2*w_fbms-waveguide_w              (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y-etch_w-2*w_fbms-waveguide_w   ],etchingdose_2);









    %%defining of the etching elemets around the lower fbms elemet
    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)         g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)          g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)         g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)     ; ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend            (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend  ],   etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l  (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend-d1_length],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],90,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l        g1x_1-rec-taper-waveguide_l+p_waveguide         g1x_1-rec-taper-waveguide_l+p_waveguide g1x_1-rec-taper-waveguide_l+p_waveguide-p_waveguide     g1x_1-rec-taper-waveguide_l;...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y+4*bend          (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y+4*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y+4*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y+4*bend           (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y+4*bend   ],etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],0,etch_w,N,etchingdose_2);


    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms) );...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend ],etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend ],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);


    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms);...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y              (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y   ],etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend ],bend-(waveguide_w/2)-(w_fbms)-(etch_w/2),[0 90],270,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+2*bend+waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+2*bend+waveguide_bb ;...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend ],etchingdose_2);


    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],90,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb;...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y+4*bend        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y+4*bend          (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y+4*bend          (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y+4*bend              (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y+4*bend    ],etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb+waveguide_bb_1         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend],bend-(waveguide_w/2)-w_fbms-(etch_w/2),[0 90],0,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1         g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1          g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1 );...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend  ],etchingdose_2);

    d(end+1) =Raith_element('arc',0,[g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+4*bend+waveguide_bb_1       (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend ],bend+(waveguide_w/2)+(w_fbms)+(etch_w/2),[0 90],180,etch_w,N,etchingdose_2);

    d(end+1) =Raith_element('polygon',0,[...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend+0.5*waveguide_bb...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend+0.5*waveguide_bb...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend ;...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y         (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y          (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y              (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y   ],etchingdose_2);









    %Now for the right section etching elements, we plug the
    %above elements into the mirror function and define them.



    d(end+1) =Raith_element('polygon',g_layer,mirror_coords([g1x_1 g1x_2 g1x_2 g1x_1 g1x_1], [ y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y], mirror_x),dose_g1);

    %second gap
    d(end+1) =Raith_element('polygon',g_layer,mirror_coords([g2x_1 g2x_2 g2x_2 g2x_1 g2x_1], [y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y],mirror_x),dose_g2);

    %third gap
    d(end+1) =Raith_element('polygon',g_layer,mirror_coords([g3x_1 g3x_2 g3x_2 g3x_1 g3x_1], [y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],mirror_x),dose_g3);

    %fourth gap
    d(end+1) =Raith_element('polygon',g_layer,mirror_coords([g4x_1 g4x_2 g4x_2 g4x_1 g4x_1], [y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],mirror_x),dose_g4);



    for i = 79:1:74+n_gap
        d(end+1) = Raith_element('polygon',g_layer,mirror_coords([g_uni_1+periodicity_1 g_uni_2+periodicity_1 g_uni_2+periodicity_1 g_uni_1+periodicity_1 g_uni_1+periodicity_1], [y1_1-delta_y y1_1-delta_y y1_2-delta_y y1_2-delta_y y1_1-delta_y ],mirror_x),dose_g_uni);

        periodicity_1 = constant_periodicity_1*(i-78);
    end

    %the etching around the coupler, taper, and waveguide that are all in one
    %writefield
    d(end+1) =Raith_element('polygon',0,mirror_coords([g1x_1-rec-taper-waveguide_l      g1x_1-rec-taper-waveguide_l       g1x_1-rec-taper-waveguide_l+waveguide_l       g1x_1-rec-taper-waveguide_l+waveguide_l+taper       g1x_1       x_lastgap+max_etch     x_lastgap+max_etch      g1x_1     g1x_1-rec      g1x_1-rec-taper      g1x_1-rec-taper-waveguide_l     g1x_1-rec-taper-waveguide_l      g1x_1-rec-taper-waveguide_l+waveguide_l            g1x_1-rec-taper-waveguide_l+waveguide_l                    g1x_1-rec-taper-waveguide_l+waveguide_l+taper      g1x_1     g1x_1+x_lastgap       g1x_1+x_lastgap      g1x_1       g1x_1-rec        g1x_1-rec-taper     g1x_1-rec-taper       g1x_1-rec-taper-waveguide_l],...
        [    (y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y     (y1_2/2)+(waveguide_w/2)+min_etch-delta_y         (y1_2/2)+(waveguide_w/2)+min_etch-delta_y       y1_2+max_etch-delta_y        y1_2+max_etch-delta_y       y1_2+max_etch-delta_y         y1_1-max_etch-delta_y        y1_1-max_etch-delta_y        y1_1-max_etch-delta_y       y1_1+(y1_2/2)-(waveguide_w/2)-min_etch-delta_y         y1_1+(y1_2/2)-(waveguide_w/2)-min_etch-delta_y        y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)-delta_y        y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)-delta_y            y1_1+(y1_2/2)-(waveguide_w/2)-(w_fbms)+(w_fbms)-delta_y       y1_1-delta_y     y1_1-delta_y     y1_1-delta_y       y1_2-delta_y     y1_2-delta_y       y1_2-delta_y           (y1_2/2)+(waveguide_w/2)+(w_fbms)-(w_fbms)-delta_y                (y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y                 (y1_2/2)+(waveguide_w/2)+(w_fbms)-delta_y],mirror_x), etchingdose_1);




    [d43r_uv_c, d43r_angle, d43r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend], 180, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d43r_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d43r_theta, d43r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms), ...
        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w), ...
        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w), ...
        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w), ...
        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend], ...
        mirror_x), etchingdose_2);


    [d49r_uv_c, d49r_angle, d49r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms), ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend], 180, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d49r_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d49r_theta, d49r_angle, etch_w, N, etchingdose_2);

    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide-p_waveguide, ...
        g1x_1-rec-taper-waveguide_l], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-delta_y+4*bend], ...
        mirror_x), etchingdose_2);




    [d47r_uv_c, d47r_angle, d47r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], 0, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d47r_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d47r_theta, d47r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], mirror_x), etchingdose_2);




    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-delta_y], mirror_x), etchingdose_2);


    [d51r_uv_c, d51r_angle, d51r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb), ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend], 270, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d51r_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d51r_theta, d51r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+waveguide_bb+2*(bend-(waveguide_w/2)-w_fbms-etch_w)+etch_w], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], mirror_x), etchingdose_2);


    [d53r_uv_c, d53r_angle, d53r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], 90, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d53r_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d53r_theta, d53r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1-delta_y+4*bend], mirror_x), etchingdose_2);





    [d55r_uv_c, d55r_angle, d55r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb+waveguide_bb_1, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], 0, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d55r_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d55r_theta, d55r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+4*bend+waveguide_bb+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+4*bend+waveguide_bb+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+4*bend+waveguide_bb+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], mirror_x), etchingdose_2);


    [d57r_uv_c, d57r_angle, d57r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+waveguide_bb_1+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend], 180, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d57r_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d57r_theta, d57r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend+0.5*waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend+0.5*waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y-etch_w-2*w_fbms-waveguide_w, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y-etch_w-2*w_fbms-waveguide_w, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y-etch_w-2*w_fbms-waveguide_w, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y-etch_w-2*w_fbms-waveguide_w, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y-etch_w-2*w_fbms-waveguide_w], mirror_x), etchingdose_2);




    [d59r_uv_c, d59r_angle, d59r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend], 180, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d59r_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d59r_theta, d59r_angle, etch_w, N, etchingdose_2);

    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms), ...
        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms), ...
        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms), ...
        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms), ...
        g1x_1-rec-taper-waveguide_l-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend], mirror_x), etchingdose_2);

    [d61r_uv_c, d61r_angle, d61r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend-d1_length], 90, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d61r_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d61r_theta, d61r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide-p_waveguide, ...
        g1x_1-rec-taper-waveguide_l], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y+4*bend], mirror_x), etchingdose_2);




    [d63r_uv_c, d63r_angle, d63r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], 0, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d63r_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d63r_theta, d63r_angle, etch_w, N, etchingdose_2);

    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], mirror_x), etchingdose_2);


    [d65r_uv_c, d65r_angle, d65r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms), ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend], 180, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d65r_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d65r_theta, d65r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb), ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y], mirror_x), etchingdose_2);



    [d67r_uv_c, d67r_angle, d67r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend], 270, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d67r_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d67r_theta, d67r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+2*bend+waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+2*bend+waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)+2*bend+waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+2*bend+waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+2*bend+waveguide_bb], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], mirror_x), etchingdose_2);


    [d69r_uv_c, d69r_angle, d69r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], 90, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d69r_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d69r_theta, d69r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+(waveguide_bb)+2*bend+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+2*bend+waveguide_bb], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y+4*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-2*bend-d1_length_1+2*(w_fbms)+(waveguide_w)+etch_w-delta_y+4*bend], mirror_x), etchingdose_2);


    [d71r_uv_c, d71r_angle, d71r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+4*bend+waveguide_bb+waveguide_bb_1, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], 0, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d71r_uv_c, bend-(waveguide_w/2)-w_fbms-(etch_w/2), d71r_theta, d71r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)-(etch_w)-(w_fbms)-(waveguide_w)-(w_fbms)+4*bend+waveguide_bb+waveguide_bb_1], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length-delta_y+2*bend], mirror_x), etchingdose_2);

    [d73r_uv_c, d73r_angle, d73r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+4*bend+waveguide_bb_1, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1-delta_y+2*bend], 180, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d73r_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d73r_theta, d73r_angle, etch_w, N, etchingdose_2);


    d(end+1) = Raith_element('polygon', 0, mirror_coords([g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend+0.5*waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend+0.5*waveguide_bb, ...
        g1x_1-rec-taper-waveguide_l+p_waveguide+bend+(waveguide_w/2)+(w_fbms)+(etch_w)-(etch_w)+(bend-(waveguide_w/2)-w_fbms)+waveguide_bb+waveguide_bb_1+4*bend], ...
        [(y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)-(etch_w)+(etch_w)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-d1_length+d1_length_1+bend-(waveguide_w/2)-(w_fbms)+(etch_w)+(w_fbms)+(waveguide_w)+(w_fbms)-delta_y], mirror_x), etchingdose_2);



    [d45r_uv_c, d45r_angle, d45r_theta] = mirror_arc_coords([g1x_1-rec-taper-waveguide_l, ...
        (y1_2/2)+(waveguide_w/2)-(waveguide_w/2)-bend-delta_y+2*bend-d1_length], 90, [0 90], mirror_x);
    d(end+1) = Raith_element('arc', 0, d45r_uv_c, bend+(waveguide_w/2)+(w_fbms)+(etch_w/2), d45r_theta, d45r_angle, etch_w, N, etchingdose_2);
    % We now append d into b using the k index below.

    % Append this circuit's elements into global b
    % (Assumes d is a row/column array of Raith_element)
    if isempty(d)
        error('Circuit %d produced an empty d array. Check geometry block.', n);
    end
    Nd = numel(d);
    b(k+1:k+Nd) = d(:).';
    k = k + Nd;
end

% ---- Export
s = Raith_structure('device', b);
axis equal

grating_coupler = Raith_library('SOD_gratingcoupler', s);
grating_coupler.writegds('plain');

p = Raith_positionlist(grating_coupler, 'F:\Raith\SOD_gratingcoupler.csf', [500 500], [4.5 4.5]);

p.plot
p.append('device', [1.9 3.9], 1, [-315 -250 300 250 ]);
p.plot
p.plotWF
p.plotWA
p.writepls();

% -------- Local helper functions (MATLAB allows these in scripts) --------
function import_params_for_n(n)
    vars = evalin('base','who');
    pat = sprintf('^(.*)_%d$', n);

    for kk = 1:numel(vars)
        v = vars{kk};
        tok = regexp(v, pat, 'tokens', 'once');
        if ~isempty(tok)
            baseName = tok{1};
            assignin('caller', baseName, evalin('base', v));
        end
    end
end


 %mirroring fucntions
function mirrored_coords = mirror_coords(x_coords, y_coords, mirror_x)
    mirrored_x = mirror_x + (mirror_x - x_coords);
    mirrored_coords = [mirrored_x; y_coords];
end

function [uv_c_mirrored, angle_mirrored, theta_mirrored] = mirror_arc_coords(uv_c, angle, theta, mirror_x)
    uv_c_mirrored = [mirror_x - (uv_c(1) - mirror_x), uv_c(2)];
    angle_mirrored = -angle;
    theta_mirrored = [180 - theta(2), 180 - theta(1)];
end
