<h1>1) Overview</h1>


This repository is dedicated to generating **GDSII layouts layouts of compact, multi-circuit photonic devices** using the **Raith_GDSII MATLAB Toolbox**, with an emphasis on the **fixed-beam moving-stage (FBMS)** exposure mode.
Documentation for the Raith toolbox is available at:
https://raith-gdsii.readthedocs.io/en/latest/
(Special thanks to Aaron Hryciw for creating this toolbox) (https://github.com/ahryciw)
In order to rung the codes, you need to place the four class definitions found in the src directory (Raith_element.m, Raith_structure.m, Raith_library.m, and Raith_positionlist.m) into a folder on your MATLAB path.

The layouts produced by this code are written for **fabrication processes compatible with positive resist**. As a result, the geometry defined in the GDSII files represents **etch windows**, not the silicon structures themselves.

In other words, the polygons generated by this code correspond to **regions where material will be removed** during etching. The remaining silicon—i.e., the regions not covered by polygons—forms the actual photonic devices (waveguides, grating couplers, etc.).


<h1>2) Interpretation of the Layout and Etch Regions</h1> 

The GDSII layouts generated by this code define **etch windows for a positive-resist fabrication process**. In all figures and layouts produced by this repository, **colored (hatched) regions represent areas that will be etched**, while **white regions (left undefined in the layout)** correspond to **remaining silicon after fabrication**.


<h2>A) Grating Coupler Isolation (Figure 1)</h2> 

Figure 1 illustrates the etch strategy used around the grating coupler region.
<img width="725" height="643" alt="83f89409-3956-4379-85c1-04b25cfbc679" src="https://github.com/user-attachments/assets/9b8c73dc-dd9d-42e8-b02b-6a819e794ee7" />


The **purple region** represents the grating coupler itself, while the surrounding **red hatched polygons** define a **local isolation etch region**. A polygon extending approximately **40 µm from three sides of the grating coupler** is intentionally defined to isolate the device.

This results in the following physical structure after fabrication:
```
 silicon (grating coupler)
→ locally etched isolation region
→ surrounding silicon from the original blanket deposition
```

Only the regions explicitly drawn as polygons are etched. The **white area inside and beyond the isolation window remains silicon**, ensuring that the grating coupler is optically isolated without etching the entire silicon film across the chip.



<h2>B) Waveguide Isolation (Figure 2)</h2> 
Figure 2 shows the etch strategy used along the waveguide sections.

<img width="1187" height="863" alt="Screenshot (541)" src="https://github.com/user-attachments/assets/093ab631-b944-400b-9d5c-9ce32786a6e8" />


Instead of etching a large surrounding region, the layout defines **narrow etch windows above and below the waveguide core**. In the current design:

..........Approximately **9.5 µm** of silicon is etched above the waveguide

..........Approximately **9.5 µm** of silicon is etched below the waveguide

The waveguide itself remains as an **unetched** white region

Additionally, a narrow **FBMS-defined etch region (~0.5 µm)** is used to precisely shape the waveguide boundaries.

As in Figure 1, **all white regions are intentionally left undefined in the layout and therefore remain silicon after etching**.


<h2>C) Motivation for Local Etching</h2> 

The isolation strategy shown in Figures 1 and 2 is deliberately **local rather than global**. Etching the entire silicon deposition across the full chip would significantly **increase etch time** and **reduce process robustness.**

By defining only:

..........**40 µm isolation regions** around grating couplers, and

..........**~10 µm isolation regions** above and below waveguides,

the code achieves:

..........sufficient optical isolation between circuits,

..........reduced parasitic coupling,

..........and fabrication efficiency without unnecessary blanket etching.


<h2>D) Design Goal: Compact Cut-Back Test Structures</h2>

The generated layouts are optimized for the **cut-back method**. Each circuit:

..........contains the **same number of bends**,

..........follows the **same general topology**, and

..........differs only in **waveguide path length**.

This allows:

..........extraction of **waveguide propagation loss** from transmission measurements,

..........assessment of **grating coupler efficiency**, and

compact placement of many test structures within a limited chip area.



<h2>E) Repository Structure</h2>

```
.
├── params_all_circuits.m
├── generate_layout_from_workspace.m
└── README.md
```


<h1>3) params_all_circuits.m</h1>

This file defines all **circuit-specific parameters**.

Each parameter is suffixed with _n, where n **corresponds to the circuit numbe**r shown in **Figure 3**.

<img width="2578" height="1344" alt="Screenshot (543)" src="https://github.com/user-attachments/assets/5920ec95-292b-4063-adc1-bace52d2e0f1" />


Examples:
```
waveguide_bb_6
delta_y_6
bend_6
```

Circuit numbers in the layout (1–9) map **directly** to these parameter suffixes.
For example, **Circuit** 6 in Figure 1 uses:
```
*_6
```
parameters throughout the code.

<h2>Geometry Parameterization (Figure 4) </h2>

**Figure 4** shows a single circuit annotated with the variables used in the code. Each labeled section corresponds directly to a parameter in params_all_circuits.m.

<img width="1452" height="1082" alt="Screenshot (545)" src="https://github.com/user-attachments/assets/553649f3-00ef-4d39-aea4-21c2a60881c1" />

Changing these parameters in params_all_circuits.m directly modifies the physical layout shown in Figure 3.

<h1>4) generate_layout_from_workspace.m</h1>

This is the **main layout generation script**.

<h2>Key Features</h1>

<h3>A) Left-Side Definition with Automatic Mirroring</h3>
Only the **left-hand side of the chip is explicitly defined** in the layout code. All waveguides, tapers, bends, and grating couplers are first constructed for the left side.

The corresponding **right-hand side structures are generated automatically by mirroring** the left-side geometry using dedicated coordinate-mirroring functions. the **mirror_arc_coords** function is for mirroring the arcs, and **mirror_coords** function is for mirroring polygons.



<h3>B) Two Geometry Loops - with and without FBMS</h3>

Two separate loops are used to correctly handle different circuit topologies:

..........**Circuits 1–5** share one geometry block, and have fbms elements around their waveguides.

..........**Circuits 6–9** share a second geometry block (based on Circuit 6), and don't have fbms elements around their waveguides.

The FBMS elements are useful for fabricating circuits that span **multiple write fields**, as they help **mitigate stitching errors**. FBMS geometric features are included for all circuits; however, for circuits **6–9**, the FBMS width is set to zero in params_all_circuits.m, so these features are not generated. This behavior can be modified by assigning a non-zero width value if FBMS exposure is desired for those circuits.


<h3>C) Index-Safe Element Creation</h3>

All layout elements are appended using:
```
d(end+1) = Raith_element(...);
```

This avoids:

..........hard-coded element indices,

..........accidental overwriting,

..........gaps in the element array,

..........spurious geometry artifacts (e.g. unintended arcs).

<h3>D) Global Element Accumulation</h3>

Each circuit’s geometry is added to a global list b.
After all circuits are generated:

..........a single Raith_structure is created,

..........the structure is written to GDSII,

..........CSF and PLS files are generated for Raith exposure and placement.

<h1>5) How the Code Works (Summary)</h1>

**1.Load parameters**
```
run('params_all_circuits.m');
```

**2.Generate layout**
```
run('generate_layout_from_workspace.m');
```



